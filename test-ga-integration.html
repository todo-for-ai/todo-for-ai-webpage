<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <h1>🔍 Google Analytics 4 集成测试</h1>
    
    <div class="status" id="gaStatus">
        <strong>GA状态:</strong> 检查中...
    </div>

    <div class="test-section">
        <h2>📊 基础功能测试</h2>
        <p>测试基础的GA功能是否正常工作</p>
        <button class="test-button" onclick="testPageView()">测试页面浏览</button>
        <button class="test-button" onclick="testCustomEvent()">测试自定义事件</button>
        <button class="test-button" onclick="testErrorTracking()">测试错误追踪</button>
    </div>

    <div class="test-section">
        <h2>🔐 认证事件测试</h2>
        <p>测试用户认证相关的事件追踪</p>
        <button class="test-button" onclick="testLogin('github')">测试GitHub登录</button>
        <button class="test-button" onclick="testLogin('google')">测试Google登录</button>
        <button class="test-button" onclick="testLogout()">测试登出</button>
    </div>

    <div class="test-section">
        <h2>📋 项目管理测试</h2>
        <p>测试项目管理相关的事件追踪</p>
        <button class="test-button" onclick="testProjectCreate()">测试项目创建</button>
        <button class="test-button" onclick="testProjectView()">测试项目查看</button>
        <button class="test-button" onclick="testProjectEdit()">测试项目编辑</button>
    </div>

    <div class="test-section">
        <h2>✅ 任务管理测试</h2>
        <p>测试任务管理相关的事件追踪</p>
        <button class="test-button" onclick="testTaskCreate()">测试任务创建</button>
        <button class="test-button" onclick="testTaskView()">测试任务查看</button>
        <button class="test-button" onclick="testTaskStatusChange()">测试状态变更</button>
        <button class="test-button" onclick="testTaskComplete()">测试任务完成</button>
    </div>

    <div class="test-section">
        <h2>🌐 社交功能测试</h2>
        <p>测试社交互动相关的事件追踪</p>
        <button class="test-button" onclick="testWeChatGroup()">测试微信群</button>
        <button class="test-button" onclick="testTelegramGroup()">测试Telegram群</button>
    </div>

    <div class="test-section">
        <h2>⚙️ 设置功能测试</h2>
        <p>测试设置变更相关的事件追踪</p>
        <button class="test-button" onclick="testLanguageChange()">测试语言切换</button>
        <button class="test-button" onclick="testThemeChange()">测试主题切换</button>
    </div>

    <div class="test-section">
        <h2>📝 测试日志</h2>
        <div class="log" id="testLog"></div>
        <button class="test-button" onclick="clearLog()">清空日志</button>
    </div>

    <script>
        // 模拟analytics模块
        const analytics = {
            auth: {
                login: (method) => trackEvent('login', { event_category: 'authentication', method }),
                logout: () => trackEvent('logout', { event_category: 'authentication' }),
                register: (method) => trackEvent('sign_up', { event_category: 'authentication', method })
            },
            project: {
                create: (projectId) => trackEvent('create_project', { event_category: 'project', project_id: projectId }),
                view: (projectId) => trackEvent('view_project', { event_category: 'project', project_id: projectId }),
                edit: (projectId) => trackEvent('edit_project', { event_category: 'project', project_id: projectId })
            },
            task: {
                create: (taskId, projectId) => trackEvent('create_task', { event_category: 'task', task_id: taskId, project_id: projectId }),
                view: (taskId, projectId) => trackEvent('view_task', { event_category: 'task', task_id: taskId, project_id: projectId }),
                statusChange: (taskId, fromStatus, toStatus) => trackEvent('task_status_change', { event_category: 'task', task_id: taskId, from_status: fromStatus, to_status: toStatus }),
                complete: (taskId, projectId) => trackEvent('complete_task', { event_category: 'task', task_id: taskId, project_id: projectId })
            },
            social: {
                joinWeChatGroup: () => trackEvent('join_wechat_group', { event_category: 'social' }),
                joinTelegramGroup: () => trackEvent('join_telegram_group', { event_category: 'social' })
            },
            settings: {
                changeLanguage: (language) => trackEvent('change_language', { event_category: 'settings', language }),
                changeTheme: (theme) => trackEvent('change_theme', { event_category: 'settings', theme })
            },
            error: {
                jsError: (error, source) => trackEvent('javascript_error', { event_category: 'error', error_message: error, source })
            }
        };

        function trackEvent(eventName, parameters) {
            log(`🎯 Event: ${eventName}`, parameters);
            if (typeof window.gtag === 'function') {
                window.gtag('event', eventName, parameters);
                log('✅ Event sent to GA4');
            } else {
                log('⚠️ GA4 not available');
            }
        }

        function trackPageView(path, title) {
            log(`📄 Page View: ${path}`, { title });
            if (typeof window.gtag === 'function') {
                window.gtag('config', 'G-XXXXXXXXXX', {
                    page_path: path,
                    page_title: title
                });
                log('✅ Page view sent to GA4');
            } else {
                log('⚠️ GA4 not available');
            }
        }

        function log(message, data = null) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            let logEntry = `[${timestamp}] ${message}`;
            if (data) {
                logEntry += `\n${JSON.stringify(data, null, 2)}`;
            }
            logElement.innerHTML += logEntry + '\n\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        // 检查GA状态
        function checkGAStatus() {
            const statusElement = document.getElementById('gaStatus');
            
            if (typeof window.gtag === 'function') {
                statusElement.className = 'status success';
                statusElement.innerHTML = '<strong>GA状态:</strong> ✅ Google Analytics 4 已加载并可用';
                log('✅ GA4 initialization check passed');
            } else if (typeof window.dataLayer !== 'undefined') {
                statusElement.className = 'status warning';
                statusElement.innerHTML = '<strong>GA状态:</strong> ⚠️ dataLayer存在但gtag函数未定义';
                log('⚠️ dataLayer exists but gtag function not defined');
            } else {
                statusElement.className = 'status error';
                statusElement.innerHTML = '<strong>GA状态:</strong> ❌ Google Analytics 4 未加载';
                log('❌ GA4 not loaded');
            }
        }

        // 测试函数
        function testPageView() {
            trackPageView('/test-page', 'Test Page Title');
        }

        function testCustomEvent() {
            trackEvent('test_custom_event', {
                event_category: 'test',
                event_label: 'manual_test',
                value: 1
            });
        }

        function testErrorTracking() {
            analytics.error.jsError('Test error message', 'test-ga-integration.html');
        }

        function testLogin(method) {
            analytics.auth.login(method);
        }

        function testLogout() {
            analytics.auth.logout();
        }

        function testProjectCreate() {
            analytics.project.create('test-project-123');
        }

        function testProjectView() {
            analytics.project.view('test-project-123');
        }

        function testProjectEdit() {
            analytics.project.edit('test-project-123');
        }

        function testTaskCreate() {
            analytics.task.create('test-task-456', 'test-project-123');
        }

        function testTaskView() {
            analytics.task.view('test-task-456', 'test-project-123');
        }

        function testTaskStatusChange() {
            analytics.task.statusChange('test-task-456', 'todo', 'in_progress');
        }

        function testTaskComplete() {
            analytics.task.complete('test-task-456', 'test-project-123');
        }

        function testWeChatGroup() {
            analytics.social.joinWeChatGroup();
        }

        function testTelegramGroup() {
            analytics.social.joinTelegramGroup();
        }

        function testLanguageChange() {
            analytics.settings.changeLanguage('en');
        }

        function testThemeChange() {
            analytics.settings.changeTheme('dark');
        }

        // 页面加载时检查GA状态
        window.addEventListener('load', () => {
            setTimeout(checkGAStatus, 1000); // 延迟1秒检查，确保GA脚本有时间加载
            log('🚀 GA Integration Test Page Loaded');
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Google Analytics 4 é›†æˆæµ‹è¯•</h1>
    
    <div class="status" id="gaStatus">
        <strong>GAçŠ¶æ€:</strong> æ£€æŸ¥ä¸­...
    </div>

    <div class="test-section">
        <h2>ğŸ“Š åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <p>æµ‹è¯•åŸºç¡€çš„GAåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        <button class="test-button" onclick="testPageView()">æµ‹è¯•é¡µé¢æµè§ˆ</button>
        <button class="test-button" onclick="testCustomEvent()">æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶</button>
        <button class="test-button" onclick="testErrorTracking()">æµ‹è¯•é”™è¯¯è¿½è¸ª</button>
    </div>

    <div class="test-section">
        <h2>ğŸ” è®¤è¯äº‹ä»¶æµ‹è¯•</h2>
        <p>æµ‹è¯•ç”¨æˆ·è®¤è¯ç›¸å…³çš„äº‹ä»¶è¿½è¸ª</p>
        <button class="test-button" onclick="testLogin('github')">æµ‹è¯•GitHubç™»å½•</button>
        <button class="test-button" onclick="testLogin('google')">æµ‹è¯•Googleç™»å½•</button>
        <button class="test-button" onclick="testLogout()">æµ‹è¯•ç™»å‡º</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ é¡¹ç›®ç®¡ç†æµ‹è¯•</h2>
        <p>æµ‹è¯•é¡¹ç›®ç®¡ç†ç›¸å…³çš„äº‹ä»¶è¿½è¸ª</p>
        <button class="test-button" onclick="testProjectCreate()">æµ‹è¯•é¡¹ç›®åˆ›å»º</button>
        <button class="test-button" onclick="testProjectView()">æµ‹è¯•é¡¹ç›®æŸ¥çœ‹</button>
        <button class="test-button" onclick="testProjectEdit()">æµ‹è¯•é¡¹ç›®ç¼–è¾‘</button>
    </div>

    <div class="test-section">
        <h2>âœ… ä»»åŠ¡ç®¡ç†æµ‹è¯•</h2>
        <p>æµ‹è¯•ä»»åŠ¡ç®¡ç†ç›¸å…³çš„äº‹ä»¶è¿½è¸ª</p>
        <button class="test-button" onclick="testTaskCreate()">æµ‹è¯•ä»»åŠ¡åˆ›å»º</button>
        <button class="test-button" onclick="testTaskView()">æµ‹è¯•ä»»åŠ¡æŸ¥çœ‹</button>
        <button class="test-button" onclick="testTaskStatusChange()">æµ‹è¯•çŠ¶æ€å˜æ›´</button>
        <button class="test-button" onclick="testTaskComplete()">æµ‹è¯•ä»»åŠ¡å®Œæˆ</button>
    </div>

    <div class="test-section">
        <h2>ğŸŒ ç¤¾äº¤åŠŸèƒ½æµ‹è¯•</h2>
        <p>æµ‹è¯•ç¤¾äº¤äº’åŠ¨ç›¸å…³çš„äº‹ä»¶è¿½è¸ª</p>
        <button class="test-button" onclick="testWeChatGroup()">æµ‹è¯•å¾®ä¿¡ç¾¤</button>
        <button class="test-button" onclick="testTelegramGroup()">æµ‹è¯•Telegramç¾¤</button>
    </div>

    <div class="test-section">
        <h2>âš™ï¸ è®¾ç½®åŠŸèƒ½æµ‹è¯•</h2>
        <p>æµ‹è¯•è®¾ç½®å˜æ›´ç›¸å…³çš„äº‹ä»¶è¿½è¸ª</p>
        <button class="test-button" onclick="testLanguageChange()">æµ‹è¯•è¯­è¨€åˆ‡æ¢</button>
        <button class="test-button" onclick="testThemeChange()">æµ‹è¯•ä¸»é¢˜åˆ‡æ¢</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
        <div class="log" id="testLog"></div>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        // æ¨¡æ‹Ÿanalyticsæ¨¡å—
        const analytics = {
            auth: {
                login: (method) => trackEvent('login', { event_category: 'authentication', method }),
                logout: () => trackEvent('logout', { event_category: 'authentication' }),
                register: (method) => trackEvent('sign_up', { event_category: 'authentication', method })
            },
            project: {
                create: (projectId) => trackEvent('create_project', { event_category: 'project', project_id: projectId }),
                view: (projectId) => trackEvent('view_project', { event_category: 'project', project_id: projectId }),
                edit: (projectId) => trackEvent('edit_project', { event_category: 'project', project_id: projectId })
            },
            task: {
                create: (taskId, projectId) => trackEvent('create_task', { event_category: 'task', task_id: taskId, project_id: projectId }),
                view: (taskId, projectId) => trackEvent('view_task', { event_category: 'task', task_id: taskId, project_id: projectId }),
                statusChange: (taskId, fromStatus, toStatus) => trackEvent('task_status_change', { event_category: 'task', task_id: taskId, from_status: fromStatus, to_status: toStatus }),
                complete: (taskId, projectId) => trackEvent('complete_task', { event_category: 'task', task_id: taskId, project_id: projectId })
            },
            social: {
                joinWeChatGroup: () => trackEvent('join_wechat_group', { event_category: 'social' }),
                joinTelegramGroup: () => trackEvent('join_telegram_group', { event_category: 'social' })
            },
            settings: {
                changeLanguage: (language) => trackEvent('change_language', { event_category: 'settings', language }),
                changeTheme: (theme) => trackEvent('change_theme', { event_category: 'settings', theme })
            },
            error: {
                jsError: (error, source) => trackEvent('javascript_error', { event_category: 'error', error_message: error, source })
            }
        };

        function trackEvent(eventName, parameters) {
            log(`ğŸ¯ Event: ${eventName}`, parameters);
            if (typeof window.gtag === 'function') {
                window.gtag('event', eventName, parameters);
                log('âœ… Event sent to GA4');
            } else {
                log('âš ï¸ GA4 not available');
            }
        }

        function trackPageView(path, title) {
            log(`ğŸ“„ Page View: ${path}`, { title });
            if (typeof window.gtag === 'function') {
                window.gtag('config', 'G-XXXXXXXXXX', {
                    page_path: path,
                    page_title: title
                });
                log('âœ… Page view sent to GA4');
            } else {
                log('âš ï¸ GA4 not available');
            }
        }

        function log(message, data = null) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            let logEntry = `[${timestamp}] ${message}`;
            if (data) {
                logEntry += `\n${JSON.stringify(data, null, 2)}`;
            }
            logElement.innerHTML += logEntry + '\n\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        // æ£€æŸ¥GAçŠ¶æ€
        function checkGAStatus() {
            const statusElement = document.getElementById('gaStatus');
            
            if (typeof window.gtag === 'function') {
                statusElement.className = 'status success';
                statusElement.innerHTML = '<strong>GAçŠ¶æ€:</strong> âœ… Google Analytics 4 å·²åŠ è½½å¹¶å¯ç”¨';
                log('âœ… GA4 initialization check passed');
            } else if (typeof window.dataLayer !== 'undefined') {
                statusElement.className = 'status warning';
                statusElement.innerHTML = '<strong>GAçŠ¶æ€:</strong> âš ï¸ dataLayerå­˜åœ¨ä½†gtagå‡½æ•°æœªå®šä¹‰';
                log('âš ï¸ dataLayer exists but gtag function not defined');
            } else {
                statusElement.className = 'status error';
                statusElement.innerHTML = '<strong>GAçŠ¶æ€:</strong> âŒ Google Analytics 4 æœªåŠ è½½';
                log('âŒ GA4 not loaded');
            }
        }

        // æµ‹è¯•å‡½æ•°
        function testPageView() {
            trackPageView('/test-page', 'Test Page Title');
        }

        function testCustomEvent() {
            trackEvent('test_custom_event', {
                event_category: 'test',
                event_label: 'manual_test',
                value: 1
            });
        }

        function testErrorTracking() {
            analytics.error.jsError('Test error message', 'test-ga-integration.html');
        }

        function testLogin(method) {
            analytics.auth.login(method);
        }

        function testLogout() {
            analytics.auth.logout();
        }

        function testProjectCreate() {
            analytics.project.create('test-project-123');
        }

        function testProjectView() {
            analytics.project.view('test-project-123');
        }

        function testProjectEdit() {
            analytics.project.edit('test-project-123');
        }

        function testTaskCreate() {
            analytics.task.create('test-task-456', 'test-project-123');
        }

        function testTaskView() {
            analytics.task.view('test-task-456', 'test-project-123');
        }

        function testTaskStatusChange() {
            analytics.task.statusChange('test-task-456', 'todo', 'in_progress');
        }

        function testTaskComplete() {
            analytics.task.complete('test-task-456', 'test-project-123');
        }

        function testWeChatGroup() {
            analytics.social.joinWeChatGroup();
        }

        function testTelegramGroup() {
            analytics.social.joinTelegramGroup();
        }

        function testLanguageChange() {
            analytics.settings.changeLanguage('en');
        }

        function testThemeChange() {
            analytics.settings.changeTheme('dark');
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥GAçŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkGAStatus, 1000); // å»¶è¿Ÿ1ç§’æ£€æŸ¥ï¼Œç¡®ä¿GAè„šæœ¬æœ‰æ—¶é—´åŠ è½½
            log('ğŸš€ GA Integration Test Page Loaded');
        });
    </script>
</body>
</html>
